#!/usr/bin/env bash

set -e

: "${USER:=onur}"
: "${PASSWORD:=z}"
: "${HOST:=localhost}"
: "${PORT:=5984}"
: "${PROTOCOL:=http}"
: "${NAME:=example}"

URL="$PROTOCOL://$USER:$PASSWORD@$HOST:$PORT"

configure_couch () {
    until curl --output /dev/null --silent --head --fail "$1"; do
        printf '.'
        sleep 1
    done

    curl -X PUT "$1/$NAME"
    curl -X PUT "$1/_users"
    curl -X PUT "$1/_replicator"
}

configure_couch "$URL"

